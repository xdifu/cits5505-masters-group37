<!-- Page for submitting text for sentiment analysis. -->
<!-- Extends the base layout and includes the analysis form. -->
{% extends "base.html" %}
{% import 'bootstrap_wtf.html' as wtf %} <!-- Assuming you have bootstrap_wtf.html or similar -->

{% block title %}Analyze Text - Sentiment Analyzer{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10 col-lg-8">
        <h1 class="mb-4 display-5 cyberpunk-title" data-text="Analyze News Sentiment">Analyze News Sentiment</h1>
        
        <div class="card tilt-card mb-4">
            <div class="card-body">
                <p class="lead">Paste the news text into the box below and click "Analyze Sentiment" to discover the underlying tone.</p>
                <p>Our advanced AI will analyze whether the content is <span class="badge bg-success">Positive</span>, <span class="badge bg-secondary">Neutral</span>, or <span class="badge bg-danger">Negative</span>.</p>
            </div>
        </div>

        <!-- Add id for AJAX targeting -->
        <!-- Assuming the route passes the 'form' object -->
        <form id="analysis-form" method="POST" action="{{ url_for('main.analyze') }}" novalidate class="card tilt-card">
            <div class="card-body">
                {{ form.hidden_tag() }} <!-- Include CSRF token -->
                <div class="mb-4">
                    {# Assuming wtf.form_field renders the label and field for news_text #}
                    {{ wtf.form_field(form.news_text, class="form-control form-control-lg cyberpunk-textarea", rows="10", placeholder="Enter news article text here...") }}
                </div>
                {# Render the submit button directly, applying Bootstrap classes #}
                {# Avoid using wtf.form_field for submit buttons to prevent duplicate labels #}
                <div class="mb-3 text-center">
                    {{ form.submit(class="btn btn-primary btn-lg cyberpunk-btn") }}
                </div>
            </div>
        </form>

        <!-- Add loading indicator element (hidden by default) -->
        <div id="loading-indicator" style="display: none;" class="text-center mt-4">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Analyzing your text with advanced AI...</p>
        </div>

        <!-- Add element for displaying AJAX results -->
        <div id="ajax-result-display" class="mt-4">
            <!-- AJAX results will be injected here -->
        </div>

        <!-- Keep original result display for non-AJAX fallback or initial load -->
        {# Updated to display sentiment, intents, and keywords from analysis_data #}
        {% if analysis_data and not request.is_xhr %}
        <div class="result mt-4 tilt-card p-4">
            <h2 class="h4 cyberpunk-subheader">Analysis Result:</h2>
            
            <p class="display-6 mt-3">
                <strong>Sentiment:</strong>
                {% if analysis_data.sentiment == 'Positive' %}
                    <span class="badge bg-success fs-5">{{ analysis_data.sentiment }}</span>
                {% elif analysis_data.sentiment == 'Negative' %}
                    <span class="badge bg-danger fs-5">{{ analysis_data.sentiment }}</span>
                {% else %}
                    <span class="badge bg-secondary fs-5">{{ analysis_data.sentiment }}</span>
                {% endif %}
            </p>

            {% if analysis_data.intents %}
            <div class="mt-3">
                <h3 class="h5">Identified Intents:</h3>
                <ul class="list-inline">
                    {% for intent in analysis_data.intents %}
                    <li class="list-inline-item"><span class="badge bg-info text-dark">{{ intent }}</span></li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            {% if analysis_data.keywords %}
            <div class="mt-3">
                <h3 class="h5">Extracted Keywords:</h3>
                <ul class="list-inline">
                    {% for keyword in analysis_data.keywords %}
                    <li class="list-inline-item"><span class="badge bg-light text-dark border">{{ keyword }}</span></li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            
            <p class="mt-3"><small>This result has been saved to your history.</small></p>
        </div>
        {% endif %}

    </div>
</div>
{% endblock %}